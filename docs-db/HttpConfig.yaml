id: HttpConfig
source_file: background-geolocation-types/src/core/config/HttpConfig.ts
signature: export interface HttpConfig {
categories:
- Config
description: |-
  **HTTP / Networking Configuration**

  The {@link HttpConfig} group controls how recorded locations are uploaded to
  your server. It defines the endpoint, HTTP verb, headers, params, batching
  behavior, and request timeouts.

  These options apply to all automatic syncs as well as manual syncs triggered
  by the app.

  @example example-1

  **Overview**

  The SDK persistently stores each recorded location in its internal SQLite
  database before attempting to upload it. The HTTP Service continuously consumes
  this queue of stored records in the background. For each record:

  1. A **record-level lock** is acquired to prevent duplicate uploads.
  2. The record is serialized into an HTTP request and posted to {@link url}.
  3. A **2xx** response marks the record as delivered and it is deleted.
  4. Failed or timed-out uploads remain locked until released for retry.

  The uploader operates automatically across:

  - background execution
  - app termination
  - device reboot

  When connectivity returns, it resumes processing any remaining records.

  | Area            | Keys                                        | Notes |
  |-----------------|----------------------------------------------|-------|
  | **Destination** | {@link url}, {@link method}                             | `method` defaults to `POST`. |
  | **Payload**     | {@link rootProperty}, {@link params}, {@link headers}          | Controls JSON body and headers. |
  | **Sync cadence** | {@link autoSync}, {@link autoSyncThreshold}, {@link batchSync}, {@link maxBatchSize} | Immediate vs batched uploads. |
  | **Network policy** | {@link disableAutoSyncOnCellular}, {@link timeout}   | Conserve bandwidth and battery. |

  **How uploads work**

  1. Each location is written to SQLite.
  2. Pending records are locked for upload.
  3. Locked records are sent to {@link url}.
  4. On success (2xx), the record is deleted.
  5. On failure, the record is unlocked and retried later.

  **The SQLite buffer**

  The storage acts as a rolling buffer and is normally empty. Records disappear
  when:

  - your server returns a 2xx (see {@link HttpEvent})
  - {@link BackgroundGeolocation.destroyLocations} is called
  - TTL from {@link PersistenceConfig.maxDaysToPersist} expires
  - {@link PersistenceConfig.maxRecordsToPersist} is exceeded

  Inspect queue size using {@link BackgroundGeolocation.getCount} or fetch with
  {@link BackgroundGeolocation.getLocations}.

  **Payload composition**

  - **Body:** JSON. If `batchSync` is `true`, an array of records is sent.
    If `rootProperty` is set, payload becomes:

    ```json
    { "<rootProperty>": [...] }
    ```

  - **Headers:** Combined from {@link headers} plus authorization if
    configured.

  - **Params:** Added to every payload at the root or under `rootProperty`.

  Uploads use `application/json`; authorization refresh requests use
  `application/x-www-form-urlencoded`.

  **Sync strategy**

  - `autoSync`: upload after each record
  - `autoSyncThreshold`: wait for N records
  - `batchSync`: upload several records in one request
  - `maxBatchSize`: max records per batch
  - `timeout`: maximum HTTP duration
  - `disableAutoSyncOnCellular`: defer uploads until Wi-Fi

  **Error handling & retries**

  On non-2xx or network failure, records remain in queue and are retried when:

  - new locations arrive
  - app resumes / device boots
  - {@link BackgroundGeolocation.onConnectivityChange} fires
  - {@link BackgroundGeolocation.onHeartbeat} fires
  - iOS background fetch runs

  Or manually:

  ```ts
  await BackgroundGeolocation.sync();
  ```

  **HTTP Logging**

  Logs provide insight into HTTP behavior:

  ```text
  üìç Location
  ‚úÖ INSERT: record stored
  üîí Locked 1 records
  üîµ HTTP POST
  üîµ Response: 200
  ‚úÖ DESTROY
  ```

  | # | Entry                     | Meaning |
  |:-:|---------------------------|---------|
  | 1 | `üìç Location`             | Raw location recorded |
  | 2 | `INSERT`                 | Persisted to SQLite |
  | 3 | `Locked`                 | Marked for upload |
  | 4 | `HTTP POST/PUT`          | Attempted upload |
  | 5 | `Response`               | Server status |
  | 6 | `DESTROY` / `UNLOCK`     | Success / failed retry |

  **Remote control via HTTP response (RPC)**

  Your server may instruct the SDK to execute commands by returning JSON
  containing a `background_geolocation` payload.

  **Multiple commands**
  ```json
  {
    "background_geolocation": [
      ["setConfig", { "geolocation": { "distanceFilter": 25 } }],
      ["start"]
    ]
  }
  ```

  **Single command**
  ```json
  { "background_geolocation": ["stop"] }
  ```

  **Supported remote commands**

  | Command           | Arguments                  | Effect |
  |-------------------|----------------------------|--------|
  | `"start"`         | ‚Äî                          | {@link BackgroundGeolocation.start} |
  | `"stop"`          | ‚Äî                          | {@link BackgroundGeolocation.stop} |
  | `"startGeofences"`| ‚Äî                          | {@link BackgroundGeolocation.startGeofences} |
  | `"changePace"`    | boolean                    | {@link BackgroundGeolocation.changePace} |
  | `"setConfig"`     | `{Config}`                 | {@link BackgroundGeolocation.setConfig} |
  | `"addGeofence"`   | `{Geofence}`               | {@link BackgroundGeolocation.addGeofence} |
  | `"addGeofences"`  | `[{Geofence}, ...]`        | {@link BackgroundGeolocation.addGeofences} |
  | `"removeGeofence"`| `identifier:string`        | {@link BackgroundGeolocation.removeGeofence} |
  | `"removeGeofences"`| list or none             | remove all or some |
  | `"uploadLog"`     | `url:string`               | upload plugin log |
  | `"destroyLog"`    | ‚Äî                          | delete plugin log |

  **Examples**

  @example example-2

  @example example-3

  @example example-4

  @example example-5

  **Migration from legacy flat Config**

  @example example-6

  @example example-7

  Legacy keys remain available but are **@deprecated** and will be removed in a
  future major release.
examples:
  example-1:
    title: Example 1
    code:
      ts: |-
        BackgroundGeolocation.ready({
          http: {
            url: "https://example.com/locations",
            autoSync: true,
            params: { user_id: 1234 }
          }
        });
  example-2:
    title: Simple upload
    code:
      ts: |-
        BackgroundGeolocation.ready({
          http: {
            url: "https://api.example.com/locations",
            method: "POST",
            autoSync: true,
            headers: { Authorization: "Bearer secret" },
            params: { device_id: "abc-123" }
          }
        });
  example-3:
    title: Batched uploads
    code:
      ts: |-
        BackgroundGeolocation.ready({
          http: {
            url: "https://api.example.com/locations/bulk",
            autoSync: true,
            batchSync: true,
            maxBatchSize: 25,
            autoSyncThreshold: 10,
            rootProperty: "locations"
          }
        });
  example-4:
    title: Conserve cellular data
    code:
      ts: |-
        BackgroundGeolocation.ready({
          http: {
            url: "https://api.example.com/locations",
            autoSync: true,
            disableAutoSyncOnCellular: true
          }
        });
  example-5:
    title: Manual sync
    code:
      ts: |-
        await BackgroundGeolocation.setConfig({
          http: { url: "https://api.example.com", autoSync: false }
        });

        await BackgroundGeolocation.sync();
  example-6:
    title: Old
    code:
      ts: |-
        BackgroundGeolocation.ready({
          url: "https://api.example.com",
          autoSync: true,
          headers: { Authorization: "Bearer ..." }
        });
  example-7:
    title: New (compound)
    code:
      ts: |-
        BackgroundGeolocation.ready({
          http: {
            url: "https://api.example.com",
            autoSync: true,
            headers: { Authorization: "Bearer ..." }
          }
        });
