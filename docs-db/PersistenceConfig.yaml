id: PersistenceConfig
source_file: background-geolocation-types/src/core/config/PersistenceConfig.ts
signature: export interface PersistenceConfig {
categories:
- Config
description: |-
  <!-- doc-id: PersistenceConfig -->
  **Persistence / Storage Configuration**

  The **PersistenceConfig** group controls how the SDK stores, orders, and
  purges records in its on-device SQLite database. The database acts as a
  durable buffer between data producers (locations, geofences) and consumers
  (your app code and the HTTP service).

  @example example-1

  The SDK **prefers an empty database**. Each new {@link Location} (and geofence
  event) is written to SQLite immediately, then consumed (and typically deleted)
  by downstream services such as the HTTP uploader. When a record is successfully
  processed (e.g., posted to your server), it is removed to keep the buffer
  small and responsive.

  Configure **PersistenceConfig** via {@link Config.persistence}.

  __What gets stored?__

  - **Locations** recorded by the tracker
  - **Geofence events** (enter / exit / dwell)
  - **Extras** merged at write time via {@link extras}

  __When are records deleted?__

  A record is deleted when **any** of the following occur:

  - Your server returns a `20x` for the HTTP upload (see {@link HttpConfig})
  - You call {@link BackgroundGeolocation.destroyLocations}
  - {@link maxDaysToPersist} elapses (rolling TTL purge)
  - {@link maxRecordsToPersist} would be exceeded
    (oldest records are dropped)

  Inspect pending records using:

  - {@link BackgroundGeolocation.getCount}
  - {@link BackgroundGeolocation.getLocations}

  __Ordering__

  The order in which records are selected for upload or consumption is controlled by
  {@link locationsOrderDirection}:

  - `"ASC"` → oldest first (default)
  - `"DESC"` → newest first

  __JSON templating__

  Customize the JSON structure of uploaded records:

  - {@link locationTemplate}
  - {@link geofenceTemplate}

  Templates receive the full record context and can reshape, rename, or nest fields
  to match backend requirements (see also {@link HttpConfig.rootProperty}).

  __Extras__

  {@link extras} is a free-form key/value map merged into **every**
  record when written. Ideal for static context such as `user_id`, `route_id`,
  `appVersion`, etc.

  __Persist mode__

  Control what is written to SQLite with {@link PersistMode}:

  - {@link PersistMode.All} — persist **locations + geofences**
  - {@link PersistMode.Location} — persist **locations only**
  - {@link PersistMode.Geofence} — persist **geofences only**
  - {@link PersistMode.None} — **do not persist** (live callbacks still fire)

  > Even with {@link PersistMode.None}, HTTP uploads can still occur if triggered
  > directly. Persistence controls the *buffer*, not the upload.

  @example example-2

  In this case, the fetched location is persisted (because `persist: true`,
  overriding {@link persistMode}), then uploaded immediately if
  {@link HttpConfig.autoSync} is enabled.

  __ProviderChange Records__

  Disable storage of diagnostic “provider change” records (GPS toggled, settings
  changed, etc.) with {@link disableProviderChangeRecord} to keep
  the database lean.

  __Examples__

  @example configure-persistence-behavior

  @example inspect-and-purge-the-database

  @example custom-json-templates

  @example migration-from-legacy-flat-config

  @example now-grouped-under-persistenceconfig

  Legacy keys remain but are marked **@deprecated**. Prefer the compound form going forward.
examples:
  example-1:
    title: Example 1
    code:
      ts: |-
        BackgroundGeolocation.ready({
          persistence: {
            maxDaysToPersist: 3,
            maxRecordsToPersist: 1000,
            extras: {
              'user_id': 123,
              'appVersion': '1.2.3'
            },
            persistMode: PersistMode.All
          }
        });
  example-2:
    title: Example 2
    code:
      ts: |-
        const location = await bg.BackgroundGeolocation.getCurrentPosition({
          persist: true,
          extras: {"get_current_position": true},
          samples: 3,
        });
  configure-persistence-behavior:
    title: Configure persistence behavior
    code:
      ts: |-
        const config = {
          persistence: {
            maxDaysToPersist: 14,
            maxRecordsToPersist: 5000,
            locationsOrderDirection: 'ASC',
            persistMode: PersistMode.All,
            extras: {'user_id': 123, 'appVersion': '1.2.3'},
          },
          http: {
            url: 'https://example.com/locations',
            autoSync: true,
          }
        });
        const state = await BackgroundGeolocation.ready(config);
  inspect-and-purge-the-database:
    title: Inspect and purge the database
    code:
      ts: |-
        final pending = await BackgroundGeolocation.getCount();
        console.log('Pending records: $pending');

        // Purge all records
        final ok = await bg.BackgroundGeolocation.destroyLocations();
        console.log('Destroyed all records? $ok');
  custom-json-templates:
    title: Custom JSON templates
    code:
      ts: |-
        const config = {
          persistence: {
            locationTemplate: '''
            {
              "lat": <%= latitude %>,
              "lng": <%= longitude %>,
              "ts": "<%= timestamp %>",
              "meta": <%= JSON.stringify(extras) %>
            }
            ''',
            geofenceTemplate: '''
            {
              "id": "<%= identifier %>",
              "action": "<%= action %>",
              "ts": "<%= timestamp %>"
            }
            ''',
          },
        };
  migration-from-legacy-flat-config:
    title: Migration from legacy flat Config
    code:
      ts: |-
        // Legacy
        {
          maxDaysToPersist: 14,
          maxRecordsToPersist: 5000,
          locationsOrderDirection: 'ASC',
          locationTemplate: '{...}',
          geofenceTemplate: '{...}',
          persistMode: Config.PERSIST_MODE_ALL,
          extras: {'user_id': 123},
          disableProviderChangeRecord: true,
        };
  now-grouped-under-persistenceconfig:
    title: Now grouped under PersistenceConfig
    code:
      ts: |-
        {
          persistence: {
            maxDaysToPersist: 14,
            maxRecordsToPersist: 5000,
            locationsOrderDirection: 'ASC',
            locationTemplate: '{...}',
            geofenceTemplate: '{...}',
            persistMode: PersistMode.all,
            extras: {'user_id': 123},
            disableProviderChangeRecord: true,
          },
        };
