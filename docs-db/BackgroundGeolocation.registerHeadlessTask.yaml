id: BackgroundGeolocation.registerHeadlessTask
source_file: background-geolocation-types/src/core/api/BackgroundGeolocation.ts
signature: 'registerHeadlessTask(callback: (event: HeadlessEvent) => Promise<void>): void;'
description: |-
  Registers a Javascript callback to execute in the Android "Headless" state, where the app has been terminated configured with
  {@link AppConfig.stopOnTerminate}:false`.  The received `event` object contains a `name` (the event name) and `params` (the event data-object).

  __âš ï¸ Note Cordova &amp; Capacitor__
  - Javascript headless callbacks are not supported by Cordova or Capacitor.  See [Android Headless Mode](github:wiki/Android-Headless-Mode)

  __âš ï¸ Warning:__
  - You __must__ `registerHeadlessTask` in your application root file (eg: `index.js`).

  __âš ï¸ Warning:__
  - Your `function` __must__ be declared as `async`.  You must `await` all work within your task.  Your headless-task will automatically be terminated after executing the last line of your function.

  @example example-1

  __Debugging__

  While implementing your headless-task It's crucial to observe your Android logs in a terminal via

  ```bash
  $ adb logcat *:S TSLocationManager:V ReactNativeJS:V

  TSLocationManager: [c.t.r.HeadlessTask onHeadlessEvent] ðŸ’€  event: connectivitychange
  TSLocationManager: [c.t.r.HeadlessTask createReactContextAndScheduleTask] initialize ReactContext
  TSLocationManager: [c.t.r.HeadlessTask onHeadlessEvent] ðŸ’€  event: providerchange
  TSLocationManager: [c.t.r.HeadlessTask onHeadlessEvent] ðŸ’€  event: terminate
  ReactNativeJS: '[BGGeoHeadlessTask] ', 'connectivitychange', taskId: 1
  TSLocationManager: [c.t.r.HeadlessTask invokeStartTask] taskId: 1
  TSLocationManager: [c.t.r.HeadlessTask invokeStartTask] taskId: 2
  TSLocationManager: [c.t.r.HeadlessTask invokeStartTask] taskId: 3
  ReactNativeJS: '[BGGeoHeadlessTask] ', 'providerchange', taskId: 2
  ReactNativeJS: '[BGGeoHeadlessTask] ', 'terminate', taskId: 3
  TSLocationManager: [c.t.l.u.BackgroundTaskManager$Task start] â³ startBackgroundTask: 1
  TSLocationManager: [c.t.l.u.BackgroundTaskManager$Task start] â³ startBackgroundTask: 2
  ReactNativeJS: *** [doWork] START
  ReactNativeJS: *** [doWork] START
  TSLocationManager: [c.t.l.u.BackgroundTaskManager$Task start] â³ startBackgroundTask: 3
  ReactNativeJS: *** [doWork] START
  .
  .
  .
  ReactNativeJS: *** [doWork] FINISH
  ReactNativeJS: *** [doWork] FINISH
  ReactNativeJS: *** [doWork] FINISH
  TSLocationManager: [c.t.l.u.BackgroundTaskManager$Task stop] â³ stopBackgroundTask: 1
  TSLocationManager: [c.t.l.u.BackgroundTaskManager$Task stop] â³ stopBackgroundTask: 2
  TSLocationManager: [c.t.l.u.BackgroundTaskManager$Task stop] â³ stopBackgroundTask: 3
  TSLocationManager: [c.t.r.HeadlessTask$1 onHeadlessJsTaskFinish] taskId: 1
  TSLocationManager: [c.t.r.HeadlessTask$1 onHeadlessJsTaskFinish] taskId: 2
  TSLocationManager: [c.t.r.HeadlessTask$1 onHeadlessJsTaskFinish] taskId: 3
  ```

  __â„¹ï¸ See also:__
  - ðŸ“˜ [Android Headless Mode](github:wiki/Android-Headless-Mode).
  - {@link AppConfig.enableHeadless}
examples:
  example-1:
    title: Example 1
    code:
      ts: |-
        const BackgroundGeolocationHeadlessTask = async (event) => {
          const params = event.params;
          console.log("[BackgroundGeolocation HeadlessTask] -", event.name, params);

          switch (event.name) {
            case "terminate":
              // Use await for async tasks
              const location = await BackgroundGeolocation.getCurrentPosition({
                samples: 1,
                persist: false
              });
              console.log("[BackgroundGeolocation HeadlessTask] - getCurrentPosition:", location);
              break;
          }
          // You must await all work you do in your task.
          // Headless-tasks are automatically terminated after executing the last line of your function.
          await doWork();
        }

        BackgroundGeolocation.registerHeadlessTask(BackgroundGeolocationHeadlessTask);
